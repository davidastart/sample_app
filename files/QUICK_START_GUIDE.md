# Therapist App - Quick Start Guide

## Prerequisites

### On Your Mac (Development)
- Visual Studio Code
- GitHub Desktop
- Node.js 18+ and npm
- Python 3.11+
- Git

### On OCI Linux 9 VM (Deployment)
- Oracle Linux 9 instance
- Podman installed
- Git installed
- Access to OCI Generative AI service
- OCI CLI configured

## 1. Initial Setup on OCI VM

### 1.1 Install Podman
```bash
# Connect to your OCI Linux 9 VM
ssh opc@<your-vm-ip>

# Install Podman
sudo dnf install -y podman podman-compose

# Verify installation
podman --version
# Should show: podman version 4.x.x or later
```

### 1.2 Pull Oracle Database 23ai Container
```bash
# Pull the latest Oracle Database 23ai Free edition
podman pull container-registry.oracle.com/database/free:latest

# Verify the image
podman images | grep database
```

### 1.3 Start Oracle Database Container
```bash
# Create a volume for persistent storage
podman volume create oracle-data

# Run the Oracle Database container
podman run -d \
  --name oracle-db-23ai \
  -p 1521:1521 \
  -p 5500:5500 \
  -e ORACLE_PWD=YourSecurePassword123! \
  -e ORACLE_CHARACTERSET=AL32UTF8 \
  -v oracle-data:/opt/oracle/oradata \
  container-registry.oracle.com/database/free:latest

# Monitor the startup (this takes 5-10 minutes)
podman logs -f oracle-db-23ai

# Wait until you see:
# DATABASE IS READY TO USE!
```

### 1.4 Configure Vector Memory for 23ai
```bash
# Connect to the database
podman exec -it oracle-db-23ai sqlplus sys/YourSecurePassword123!@FREEPDB1 as sysdba

# Set vector memory (required for vector search)
ALTER SYSTEM SET vector_memory_size=500M SCOPE=SPFILE;
SHUTDOWN IMMEDIATE;
STARTUP;
EXIT;

# Restart the container to apply changes
podman restart oracle-db-23ai
```

### 1.5 Create Application Database User
```bash
# Connect as SYS
podman exec -it oracle-db-23ai sqlplus sys/YourSecurePassword123!@FREEPDB1 as sysdba
```

```sql
-- Create application user
CREATE USER therapist_app IDENTIFIED BY "AppPassword123!" 
DEFAULT TABLESPACE users 
TEMPORARY TABLESPACE temp 
QUOTA UNLIMITED ON users;

-- Grant necessary privileges
GRANT CONNECT, RESOURCE TO therapist_app;
GRANT CREATE VIEW, CREATE SYNONYM TO therapist_app;
GRANT EXECUTE ON CTXSYS.CTX_DDL TO therapist_app;
GRANT EXECUTE ON SYS.DBMS_VECTOR TO therapist_app;
GRANT EXECUTE ON SYS.DBMS_VECTOR_CHAIN TO therapist_app;

-- Grant additional privileges for JSON and vector operations
GRANT CREATE SESSION TO therapist_app;
GRANT CREATE TABLE TO therapist_app;
GRANT CREATE SEQUENCE TO therapist_app;

EXIT;
```

## 2. Initialize Database Schema

### 2.1 Create Schema Script
Create a file `schema.sql`:

```sql
-- Connect as application user
CONNECT therapist_app/AppPassword123!@//localhost:1521/FREEPDB1;

-- Therapists Table
CREATE TABLE therapists (
    therapist_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    email VARCHAR2(255) UNIQUE NOT NULL,
    first_name VARCHAR2(100) NOT NULL,
    last_name VARCHAR2(100) NOT NULL,
    license_number VARCHAR2(50),
    password_hash VARCHAR2(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP,
    is_active NUMBER(1) DEFAULT 1,
    CONSTRAINT chk_email_format CHECK (REGEXP_LIKE(email, '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}$'))
);

-- Patients Table
CREATE TABLE patients (
    patient_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    therapist_id NUMBER NOT NULL,
    first_name VARCHAR2(100) NOT NULL,
    last_name VARCHAR2(100) NOT NULL,
    date_of_birth DATE,
    patient_category VARCHAR2(100),
    initial_assessment_date DATE,
    status VARCHAR2(20) DEFAULT 'ACTIVE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP,
    CONSTRAINT fk_patient_therapist FOREIGN KEY (therapist_id) 
        REFERENCES therapists(therapist_id),
    CONSTRAINT chk_patient_status CHECK (status IN ('ACTIVE', 'DISCHARGED', 'ON_HOLD'))
);

-- Session Notes Table
CREATE TABLE session_notes (
    session_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    patient_id NUMBER NOT NULL,
    therapist_id NUMBER NOT NULL,
    session_number NUMBER,
    session_date DATE NOT NULL,
    session_duration_minutes NUMBER,
    presenting_concerns CLOB,
    symptoms_observed CLOB,
    clinical_observations CLOB,
    interventions_used CLOB,
    patient_response CLOB,
    risk_assessment CLOB,
    homework_assigned CLOB,
    session_summary CLOB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP,
    CONSTRAINT fk_session_patient FOREIGN KEY (patient_id) 
        REFERENCES patients(patient_id),
    CONSTRAINT fk_session_therapist FOREIGN KEY (therapist_id) 
        REFERENCES therapists(therapist_id)
);

-- Treatment Plans Table
CREATE TABLE treatment_plans (
    plan_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    patient_id NUMBER NOT NULL,
    therapist_id NUMBER NOT NULL,
    plan_version NUMBER DEFAULT 1,
    diagnosis_codes VARCHAR2(500),
    dsm_diagnosis VARCHAR2(500),
    treatment_goals CLOB,
    recommended_interventions CLOB,
    treatment_modality VARCHAR2(100),
    session_frequency VARCHAR2(50),
    estimated_duration VARCHAR2(50),
    ai_generated_recommendations CLOB,
    therapist_notes CLOB,
    status VARCHAR2(20) DEFAULT 'ACTIVE',
    start_date DATE,
    review_date DATE,
    end_date DATE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP,
    CONSTRAINT fk_plan_patient FOREIGN KEY (patient_id) 
        REFERENCES patients(patient_id),
    CONSTRAINT fk_plan_therapist FOREIGN KEY (therapist_id) 
        REFERENCES therapists(therapist_id),
    CONSTRAINT chk_plan_status CHECK (status IN ('DRAFT', 'ACTIVE', 'COMPLETED', 'DISCONTINUED'))
);

-- Treatment Templates Table
CREATE TABLE treatment_templates (
    template_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    template_name VARCHAR2(200) NOT NULL,
    patient_category VARCHAR2(100) NOT NULL,
    diagnosis_category VARCHAR2(200),
    evidence_based_interventions CLOB,
    typical_treatment_modalities VARCHAR2(500),
    recommended_goals CLOB,
    session_structure CLOB,
    success_indicators CLOB,
    references CLOB,
    created_by_therapist_id NUMBER,
    is_office_wide NUMBER(1) DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP,
    CONSTRAINT fk_template_therapist FOREIGN KEY (created_by_therapist_id) 
        REFERENCES therapists(therapist_id)
);

-- Evidence Base Documents (for RAG)
CREATE TABLE evidence_base_documents (
    document_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    document_type VARCHAR2(50),
    category VARCHAR2(100),
    title VARCHAR2(500) NOT NULL,
    content CLOB NOT NULL,
    source VARCHAR2(500),
    publication_date DATE,
    embedding VECTOR(1024, FLOAT32),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP
);

-- Create index on vector column for similarity search
CREATE VECTOR INDEX idx_evidence_embedding ON evidence_base_documents(embedding)
ORGANIZATION NEIGHBOR PARTITIONS
DISTANCE COSINE
WITH TARGET ACCURACY 95;

-- Audit Log Table
CREATE TABLE access_audit_log (
    log_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    therapist_id NUMBER NOT NULL,
    action VARCHAR2(100) NOT NULL,
    resource_type VARCHAR2(50) NOT NULL,
    resource_id NUMBER,
    ip_address VARCHAR2(45),
    user_agent VARCHAR2(500),
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_audit_therapist FOREIGN KEY (therapist_id) 
        REFERENCES therapists(therapist_id)
);

-- Create indexes for performance
CREATE INDEX idx_patients_therapist ON patients(therapist_id);
CREATE INDEX idx_sessions_patient ON session_notes(patient_id);
CREATE INDEX idx_sessions_therapist ON session_notes(therapist_id);
CREATE INDEX idx_sessions_date ON session_notes(session_date);
CREATE INDEX idx_plans_patient ON treatment_plans(patient_id);
CREATE INDEX idx_plans_therapist ON treatment_plans(therapist_id);
CREATE INDEX idx_templates_category ON treatment_templates(patient_category);
CREATE INDEX idx_evidence_category ON evidence_base_documents(category);
CREATE INDEX idx_audit_therapist ON access_audit_log(therapist_id);
CREATE INDEX idx_audit_timestamp ON access_audit_log(timestamp);

-- Create sequences if needed
CREATE SEQUENCE therapist_seq START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE patient_seq START WITH 1 INCREMENT BY 1;

COMMIT;

-- Verify tables were created
SELECT table_name FROM user_tables ORDER BY table_name;
```

### 2.2 Execute Schema
```bash
# Copy schema file to container
podman cp schema.sql oracle-db-23ai:/tmp/

# Execute schema
podman exec -it oracle-db-23ai sqlplus therapist_app/AppPassword123!@FREEPDB1 @/tmp/schema.sql
```

## 3. Set Up GitHub Repository

### 3.1 Initialize Repository Structure
```bash
# On your Mac
mkdir -p ~/projects/therapist-app
cd ~/projects/therapist-app

# Initialize git
git init

# Create directory structure
mkdir -p frontend/{components,pages,lib,public}
mkdir -p backend/{api,models,services,utils}
mkdir -p database/{migrations,seeds}
mkdir -p docs
mkdir -p deployment/{podman,scripts}

# Create .gitignore
cat > .gitignore << 'EOF'
# Node
node_modules/
.next/
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Python
__pycache__/
*.py[cod]
*$py.class
.Python
env/
venv/
*.so

# Environment variables
.env
.env.local
.env.*.local
*.env

# Database
*.db
*.sqlite
oracle-data/

# IDE
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# Logs
logs/
*.log

# Sensitive data
oci_config.json
*.pem
*.key
secrets/
EOF

# Create README
cat > README.md << 'EOF'
# Therapist Office Application

HIPAA-compliant treatment planning application with AI-powered recommendations.

## Features
- Secure patient management
- Session note entry
- AI-generated treatment plans using OCI Generative AI
- Evidence-based recommendations
- Multi-therapist support with data isolation

## Technology Stack
- Frontend: Next.js 14 + React
- Backend: FastAPI (Python) or Express.js (Node.js)
- Database: Oracle Database 23ai
- AI: OCI Generative AI (Cohere Command A)
- Containers: Podman

## Setup
See `docs/SETUP.md` for detailed setup instructions.

## Security
This application is designed to be HIPAA compliant. See `docs/SECURITY.md` for details.
EOF

# Initial commit
git add .
git commit -m "Initial project structure"

# Add remote (use GitHub Desktop to create the repository first)
git remote add origin https://github.com/davidastart/sample_app.git
git push -u origin main
```

## 4. Backend Setup (Python FastAPI)

### 4.1 Backend Dependencies
Create `backend/requirements.txt`:

```txt
fastapi==0.104.1
uvicorn[standard]==0.24.0
sqlalchemy==2.0.23
oracledb==2.0.0
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6
pydantic==2.5.0
pydantic-settings==2.1.0
oci==2.119.0
python-dotenv==1.0.0
httpx==0.25.2
```

### 4.2 Basic Backend Structure

Create `backend/config.py`:

```python
from pydantic_settings import BaseSettings
from typing import Optional

class Settings(BaseSettings):
    # Database
    DATABASE_HOST: str = "localhost"
    DATABASE_PORT: int = 1521
    DATABASE_SERVICE: str = "FREEPDB1"
    DATABASE_USER: str = "therapist_app"
    DATABASE_PASSWORD: str
    
    # JWT
    SECRET_KEY: str
    ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30
    
    # OCI Generative AI
    OCI_COMPARTMENT_ID: str
    OCI_REGION: str = "us-ashburn-1"
    OCI_CONFIG_FILE: Optional[str] = None
    
    # Application
    APP_NAME: str = "Therapist Office App"
    DEBUG: bool = False
    
    class Config:
        env_file = ".env"
        case_sensitive = True

settings = Settings()
```

Create `backend/database.py`:

```python
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker
from config import settings

# Oracle connection string
DATABASE_URL = (
    f"oracle+oracledb://{settings.DATABASE_USER}:"
    f"{settings.DATABASE_PASSWORD}@"
    f"{settings.DATABASE_HOST}:{settings.DATABASE_PORT}/"
    f"{settings.DATABASE_SERVICE}"
)

engine = create_engine(
    DATABASE_URL,
    echo=settings.DEBUG,
    pool_pre_ping=True,
    pool_size=10,
    max_overflow=20
)

SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

Base = declarative_base()

# Dependency for FastAPI
def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```

Create `backend/main.py`:

```python
from fastapi import FastAPI, Depends, HTTPException, status
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
from fastapi.middleware.cors import CORSMiddleware
from sqlalchemy.orm import Session
from config import settings
from database import get_db
import logging

# Configure logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# Initialize FastAPI app
app = FastAPI(
    title=settings.APP_NAME,
    version="1.0.0",
    description="HIPAA-compliant treatment planning application"
)

# CORS middleware
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],  # Frontend URL
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Security
security = HTTPBearer()

@app.get("/")
async def root():
    return {
        "message": "Therapist Office API",
        "version": "1.0.0",
        "status": "running"
    }

@app.get("/health")
async def health_check(db: Session = Depends(get_db)):
    """Health check endpoint"""
    try:
        # Test database connection
        db.execute("SELECT 1 FROM DUAL")
        return {
            "status": "healthy",
            "database": "connected"
        }
    except Exception as e:
        logger.error(f"Health check failed: {str(e)}")
        raise HTTPException(
            status_code=status.HTTP_503_SERVICE_UNAVAILABLE,
            detail="Service unavailable"
        )

# Import routers (create these next)
# from routers import auth, patients, sessions, treatment_plans
# app.include_router(auth.router, prefix="/api/auth", tags=["Authentication"])
# app.include_router(patients.router, prefix="/api/patients", tags=["Patients"])
# app.include_router(sessions.router, prefix="/api/sessions", tags=["Sessions"])
# app.include_router(treatment_plans.router, prefix="/api/treatment-plans", tags=["Treatment Plans"])

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)
```

### 4.3 OCI Generative AI Service

Create `backend/services/ai_service.py`:

```python
import oci
from oci.generative_ai_inference import GenerativeAiInferenceClient
from oci.generative_ai_inference.models import (
    CohereChatRequest,
    OnDemandServingMode,
    ChatDetails
)
from config import settings
import logging

logger = logging.getLogger(__name__)

class AIService:
    def __init__(self):
        """
        Initialize OCI Generative AI client.
        This client respects data privacy - no training on customer data.
        """
        if settings.OCI_CONFIG_FILE:
            config = oci.config.from_file(settings.OCI_CONFIG_FILE)
        else:
            config = oci.config.from_file()  # Use default ~/.oci/config
        
        self.client = GenerativeAiInferenceClient(
            config=config,
            service_endpoint=f"https://inference.generativeai.{settings.OCI_REGION}.oci.oraclecloud.com"
        )
        self.compartment_id = settings.OCI_COMPARTMENT_ID
    
    def generate_treatment_plan(
        self,
        session_data: dict,
        patient_history: dict,
        office_templates: list
    ) -> str:
        """
        Generate treatment plan using OCI Generative AI.
        
        Args:
            session_data: Current session information
            patient_history: Patient's clinical history
            office_templates: Relevant office-wide templates
            
        Returns:
            AI-generated treatment plan recommendations
        """
        
        # Build context-aware prompt
        prompt = self._build_treatment_prompt(
            session_data,
            patient_history,
            office_templates
        )
        
        try:
            # Create chat request
            chat_request = CohereChatRequest(
                message=prompt,
                max_tokens=2000,
                temperature=0.3,  # Lower for consistent clinical recommendations
                top_p=0.9,
                is_stream=False
            )
            
            chat_detail = ChatDetails(
                serving_mode=OnDemandServingMode(
                    model_id="cohere.command-a-03-2025"
                ),
                compartment_id=self.compartment_id,
                chat_request=chat_request
            )
            
            # Generate response (data stays in your tenancy)
            response = self.client.chat(chat_detail)
            
            # Extract generated text
            generated_text = response.data.chat_response.text
            
            logger.info(f"Successfully generated treatment plan")
            return generated_text
            
        except Exception as e:
            logger.error(f"Error generating treatment plan: {str(e)}")
            raise
    
    def _build_treatment_prompt(
        self,
        session_data: dict,
        patient_history: dict,
        office_templates: list
    ) -> str:
        """Build comprehensive prompt for treatment plan generation"""
        
        # Format templates
        template_text = "\n\n".join([
            f"Template for {t['patient_category']}:\n{t['evidence_based_interventions']}"
            for t in office_templates
        ])
        
        prompt = f"""You are a clinical psychology assistant helping to develop an evidence-based treatment plan. 
Base your recommendations on established clinical guidelines, the DSM-5-TR, and evidence-based practices.

PATIENT INFORMATION:
- Category: {patient_history.get('patient_category', 'Not specified')}
- Presenting Concerns: {session_data.get('presenting_concerns', 'Not documented')}
- Observed Symptoms: {session_data.get('symptoms_observed', 'Not documented')}
- Clinical Observations: {session_data.get('clinical_observations', 'Not documented')}
- Risk Assessment: {session_data.get('risk_assessment', 'Not documented')}

OFFICE EVIDENCE-BASED TEMPLATES:
{template_text if template_text else 'No templates available'}

Please provide a structured treatment plan including:

1. DIAGNOSTIC IMPRESSION:
   - Recommended DSM-5-TR diagnosis
   - ICD-10 diagnostic codes
   - Differential diagnoses to consider

2. TREATMENT GOALS (SMART format):
   - List 3-5 specific, measurable goals

3. RECOMMENDED INTERVENTIONS:
   - Evidence-based treatment modality (e.g., CBT, DBT, ACT, EMDR)
   - Specific therapeutic techniques
   - Rationale based on research

4. TREATMENT STRUCTURE:
   - Recommended session frequency (e.g., weekly, bi-weekly)
   - Estimated duration of treatment
   - Session format (individual, group, family)

5. SUCCESS INDICATORS:
   - How to measure progress
   - Expected outcomes

6. SPECIAL CONSIDERATIONS:
   - Risk factors to monitor
   - Contraindications
   - Cultural considerations

7. CLINICAL REFERENCES:
   - Cite relevant research or guidelines

Format the response in clear sections with markdown formatting.
"""
        
        return prompt

# Singleton instance
ai_service = AIService()
```

## 5. Frontend Setup (Next.js)

### 5.1 Initialize Next.js Project
```bash
# On your Mac, in the frontend directory
cd frontend
npx create-next-app@latest . --typescript --tailwind --app --no-src-dir

# Install additional dependencies
npm install @tanstack/react-query axios react-hook-form zod @hookform/resolvers
npm install @radix-ui/react-dialog @radix-ui/react-dropdown-menu
npm install lucide-react date-fns
```

### 5.2 Basic Frontend Structure

Create `frontend/lib/api.ts`:

```typescript
import axios from 'axios';

const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';

export const api = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Add auth token to requests
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('access_token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// Handle auth errors
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // Clear token and redirect to login
      localStorage.removeItem('access_token');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);
```

## 6. Containerization

### 6.1 Backend Dockerfile

Create `backend/Dockerfile`:

```dockerfile
FROM python:3.11-slim

WORKDIR /app

# Install Oracle Instant Client dependencies
RUN apt-get update && apt-get install -y \
    libaio1 \
    wget \
    unzip \
    && rm -rf /var/lib/apt/lists/*

# Copy requirements and install
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy application code
COPY . .

# Expose port
EXPOSE 8000

# Run application
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

### 6.2 Frontend Dockerfile

Create `frontend/Dockerfile`:

```dockerfile
FROM node:18-alpine AS base

# Install dependencies
FROM base AS deps
WORKDIR /app
COPY package*.json ./
RUN npm ci

# Build application
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .
RUN npm run build

# Production image
FROM base AS runner
WORKDIR /app

ENV NODE_ENV production

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000

ENV PORT 3000

CMD ["node", "server.js"]
```

### 6.3 Podman Compose

Create `deployment/podman-compose.yml`:

```yaml
version: '3.8'

services:
  oracle-db:
    image: container-registry.oracle.com/database/free:latest
    container_name: therapist-db
    environment:
      - ORACLE_PWD=YourSecurePassword123!
      - ORACLE_CHARACTERSET=AL32UTF8
    ports:
      - "1521:1521"
      - "5500:5500"
    volumes:
      - oracle-data:/opt/oracle/oradata
    healthcheck:
      test: ["CMD", "sh", "-c", "echo 'SELECT 1 FROM DUAL;' | sqlplus -s sys/YourSecurePassword123!@FREEPDB1 as sysdba"]
      interval: 30s
      timeout: 10s
      retries: 5

  backend:
    build:
      context: ../backend
      dockerfile: Dockerfile
    container_name: therapist-backend
    environment:
      - DATABASE_HOST=oracle-db
      - DATABASE_PORT=1521
      - DATABASE_SERVICE=FREEPDB1
      - DATABASE_USER=therapist_app
      - DATABASE_PASSWORD=AppPassword123!
      - SECRET_KEY=${SECRET_KEY}
      - OCI_COMPARTMENT_ID=${OCI_COMPARTMENT_ID}
      - OCI_REGION=${OCI_REGION}
    ports:
      - "8000:8000"
    depends_on:
      oracle-db:
        condition: service_healthy
    volumes:
      - ~/.oci:/root/.oci:ro

  frontend:
    build:
      context: ../frontend
      dockerfile: Dockerfile
    container_name: therapist-frontend
    environment:
      - NEXT_PUBLIC_API_URL=http://backend:8000
    ports:
      - "3000:3000"
    depends_on:
      - backend

volumes:
  oracle-data:
```

## 7. Deployment Script

Create `deployment/deploy.sh`:

```bash
#!/bin/bash

echo "=== Therapist App Deployment ==="

# Pull latest code
echo "Pulling latest code from GitHub..."
git pull origin main

# Build containers
echo "Building containers..."
cd deployment
podman-compose build

# Start services
echo "Starting services..."
podman-compose up -d

# Wait for database
echo "Waiting for database to be ready..."
sleep 30

# Check health
echo "Checking service health..."
curl -f http://localhost:8000/health || echo "Backend health check failed"
curl -f http://localhost:3000 || echo "Frontend health check failed"

echo "Deployment complete!"
echo "Frontend: http://localhost:3000"
echo "Backend: http://localhost:8000"
echo "Database: localhost:1521/FREEPDB1"
```

Make it executable:
```bash
chmod +x deployment/deploy.sh
```

## 8. Environment Variables

Create `.env.example` files:

### Backend `.env.example`:
```env
# Database
DATABASE_HOST=localhost
DATABASE_PORT=1521
DATABASE_SERVICE=FREEPDB1
DATABASE_USER=therapist_app
DATABASE_PASSWORD=your_secure_password

# JWT
SECRET_KEY=your_jwt_secret_key_min_32_chars
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# OCI Generative AI
OCI_COMPARTMENT_ID=ocid1.compartment.oc1..your_compartment_id
OCI_REGION=us-ashburn-1
OCI_CONFIG_FILE=/root/.oci/config

# Application
APP_NAME=Therapist Office App
DEBUG=False
```

### Frontend `.env.example`:
```env
NEXT_PUBLIC_API_URL=http://localhost:8000
```

## 9. Testing the Setup

### 9.1 Test Database Connection
```bash
# Connect to database
podman exec -it therapist-db sqlplus therapist_app/AppPassword123!@FREEPDB1

# Check tables
SELECT table_name FROM user_tables;

# Exit
EXIT;
```

### 9.2 Test Backend
```bash
# Start backend locally for testing
cd backend
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
pip install -r requirements.txt
uvicorn main:app --reload

# Test health endpoint
curl http://localhost:8000/health
```

### 9.3 Test Frontend
```bash
cd frontend
npm install
npm run dev

# Open browser to http://localhost:3000
```

## 10. Next Steps

1. **Complete authentication system** - Implement JWT auth, password hashing
2. **Build API routes** - Create CRUD operations for patients, sessions, treatment plans
3. **Implement AI service** - Connect OCI Generative AI for treatment plan generation
4. **Create frontend components** - Build UI for therapist dashboard, patient management
5. **Add RAG functionality** - Implement vector search for evidence-based recommendations
6. **Security hardening** - Add rate limiting, input validation, HTTPS
7. **HIPAA compliance audit** - Review all security measures
8. **Testing** - Write unit tests, integration tests, E2E tests

## 11. Useful Commands

```bash
# Podman
podman ps                          # List running containers
podman logs therapist-backend      # View backend logs
podman exec -it therapist-db bash  # Access database container
podman system prune -a             # Clean up unused containers/images

# Database
sqlplus therapist_app/password@//localhost:1521/FREEPDB1  # Connect to DB

# Git
git status                         # Check changes
git add .                          # Stage all changes
git commit -m "message"            # Commit changes
git push origin main               # Push to GitHub

# Docker/Podman Compose
podman-compose up -d               # Start all services
podman-compose down                # Stop all services
podman-compose logs -f backend     # Follow backend logs
podman-compose restart backend     # Restart backend service
```

## 12. Troubleshooting

### Database won't start
```bash
# Check logs
podman logs therapist-db

# Increase shared memory
podman run --shm-size=2g ...

# Check volume permissions
podman volume inspect oracle-data
```

### Backend can't connect to database
```bash
# Verify database is healthy
podman exec therapist-db sqlplus sys/password@FREEPDB1 as sysdba

# Check network
podman network ls
podman network inspect therapist-app-network
```

### OCI Generative AI connection fails
```bash
# Verify OCI config
cat ~/.oci/config

# Test OCI CLI
oci iam region list

# Check compartment ID
oci iam compartment list
```

---

**Ready to start!** Begin with setting up the OCI VM and deploying the database, then work through the implementation phases outlined in the main project plan.
